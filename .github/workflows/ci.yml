name: CI

on: [pull_request, push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install required dev packages
        run: |
          python -m pip install --upgrade pip

      - name: Run syntax checks (compileall)
        run: |
          python -m compileall -q .

      - name: Run legacy reference scanner
        run: |
          python scripts/find_legacy_refs.py

      - name: Ensure build default is DupeRangerAi
        run: |
          if ! grep -q 'EntryScript = "DupeRangerAi.py"' build_exe.ps1; then
            echo "build_exe.ps1 must default to DupeRangerAi.py" >&2
            exit 1
          fi
